<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Profit & Loss | BPMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal","Nirmala UI",system-ui,Arial;
  background:#f4f7f6;
  margin:0;
}

/* ===== CONTAINER ===== */
.container{
  max-width:800px;
  margin:40px auto;
  background:#fff;
  padding:35px;
  border-radius:10px;
}

h2{
  margin-top:0;
  color:#2e7d32;
  text-align:center;
}

/* ===== SUMMARY BOX ===== */
.summary{
  border:1px solid #ddd;
  border-radius:8px;
  padding:20px;
  margin-top:20px;
}
.row{
  display:flex;
  justify-content:space-between;
  padding:8px 0;
  border-bottom:1px dashed #ddd;
}
.row:last-child{border-bottom:none}

.label{font-weight:600}
.value{font-weight:700}

/* ===== PROFIT / LOSS ===== */
.profit{color:green}
.loss{color:red}

/* ===== PRINT ===== */
@media print{
  body{background:#fff}
  .container{margin:0;padding:0}
}
</style>
</head>

<body>

<div class="container">
  <h2>üìä ‡§®‡§æ‡§´‡§æ / ‡§ò‡§æ‡§ü‡§æ ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂</h2>

  <div class="summary">
    <div class="row">
      <div class="label">‡§ï‡•Å‡§≤ ‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï ‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä</div>
      <div class="value">‡§∞‡•Å. <span id="totalIncome">0</span></div>
    </div>

    <div class="row">
      <div class="label">‡§ï‡•Å‡§≤ ‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï ‡§ñ‡§∞‡•ç‡§ö</div>
      <div class="value">‡§∞‡•Å. <span id="totalExpense">0</span></div>
    </div>

    <div class="row">
      <div class="label">‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï ‡§®‡§æ‡§´‡§æ / ‡§ò‡§æ‡§ü‡§æ</div>
      <div class="value" id="profitLoss">0</div>
    </div>
  </div>

  <div class="summary" style="margin-top:30px">
    <div class="row">
      <div class="label">‡§≤‡§ó‡§æ‡§®‡•Ä‡§ï‡•ã ‡§™‡•ç‡§∞‡§§‡§ø‡§´‡§≤ (ROI)</div>
      <div class="value"><span id="roi">‚Äì</span> %</div>
    </div>

    <div class="row">
      <div class="label">‡§≤‡§ó‡§æ‡§®‡•Ä ‡§´‡§ø‡§∞‡•ç‡§§‡§æ ‡§Ö‡§µ‡§ß‡§ø</div>
      <div class="value"><span id="payback">‚Äì</span> ‡§µ‡§∞‡•ç‡§∑</div>
    </div>
  </div>
</div>

<script>
/* ===== RESTORE ACTIVE PROJECT ===== */
(function restoreActiveProject(){
  let key = localStorage.getItem("activeProject");
  if(!key) return;

  let d = JSON.parse(localStorage.getItem(key));
  if(!d) return;

  if(d.totalIncome)  localStorage.setItem("totalIncome", d.totalIncome);
  if(d.totalExpense) localStorage.setItem("totalExpense", d.totalExpense);
  if(d.shortInfo){
    localStorage.setItem("shortInfo", JSON.stringify(d.shortInfo));
  }
})();

/* ===== LOAD SUMMARY ===== */
function loadSummary(){
  let income  = parseFloat(localStorage.getItem("totalIncome")) || 0;
  let expense = parseFloat(localStorage.getItem("totalExpense")) || 0;
  let pl = income - expense;

  document.getElementById("totalIncome").innerText = income;
  document.getElementById("totalExpense").innerText = expense;

  let plEl = document.getElementById("profitLoss");
  plEl.innerText = "‡§∞‡•Å. " + pl;

  if(pl >= 0){
    plEl.className = "value profit";
  }else{
    plEl.className = "value loss";
  }

  let s = JSON.parse(localStorage.getItem("shortInfo")||"{}");
  document.getElementById("roi").innerText = s.bp_roi || "‚Äì";
  document.getElementById("payback").innerText = s.bp_payback || "‚Äì";
}

window.onload = loadSummary;
</script>

</body>
</html>
