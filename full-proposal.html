<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Full Business Proposal</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal","Nirmala UI",system-ui,Arial;
  background:#f4f7f6;
  margin:0;
}

/* ===== WRAP ===== */
.wrapper{
  max-width:1000px;
  margin:30px auto;
  background:#fff;
  padding:40px;
}

/* ===== HEADINGS ===== */
h1{
  text-align:center;
  margin-bottom:5px;
}
h2{
  border-bottom:2px solid #2e7d32;
  padding-bottom:6px;
  color:#2e7d32;
  margin-top:40px;
}
h3{
  margin-bottom:5px;
}

/* ===== TABLE ===== */
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #333;
  padding:6px;
  text-align:left;
}
th{
  background:#f0f0f0;
}

/* ===== UTIL ===== */
.center{text-align:center}
.right{text-align:right}
.profit{color:green;font-weight:700}
.loss{color:red;font-weight:700}

/* ===== PRINT ===== */
@media print{
  body{background:#fff}
  .wrapper{margin:0;padding:0}
}
</style>
</head>

<body>

<div class="wrapper">

  <!-- ================= COVER ================= -->
  <h1 id="bp_name">व्यवसायको नाम</h1>
  <p class="center" id="bp_products">व्यवसायिक प्रकृति</p>

  <table>
    <tr><th>सञ्चालन गर्ने संस्था</th><td id="bp_org"></td></tr>
    <tr><th>प्रोप्राइटर</th><td id="bp_owner"></td></tr>
    <tr><th>सम्पर्क व्यक्ति</th><td id="bp_contact"></td></tr>
    <tr><th>सञ्चालन हुने स्थान</th><td id="bp_location"></td></tr>
    <tr><th>मुख्य बजार</th><td id="bp_market"></td></tr>
  </table>

  <!-- ================= DETAIL ================= -->
  <h2>१. व्यवसायको विस्तृत विवरण</h2>
  <div id="businessDetail"></div>

  <!-- ================= EXPENSE ================= -->
  <h2>२. वार्षिक खर्च विवरण</h2>
  <table>
    <thead>
      <tr>
        <th>क्याटेगोरी</th>
        <th>शीर्षक</th>
        <th class="right">परिमाण</th>
        <th class="right">दर</th>
        <th class="right">रकम</th>
      </tr>
    </thead>
    <tbody id="expenseBody"></tbody>
    <tfoot>
      <tr>
        <th colspan="4" class="right">कुल खर्च</th>
        <th class="right" id="totalExpense"></th>
      </tr>
    </tfoot>
  </table>

  <!-- ================= INCOME ================= -->
  <h2>३. वार्षिक आम्दानी विवरण</h2>
  <table>
    <thead>
      <tr>
        <th>क्याटेगोरी</th>
        <th>शीर्षक</th>
        <th class="right">परिमाण</th>
        <th class="right">दर</th>
        <th class="right">रकम</th>
      </tr>
    </thead>
    <tbody id="incomeBody"></tbody>
    <tfoot>
      <tr>
        <th colspan="4" class="right">कुल आम्दानी</th>
        <th class="right" id="totalIncome"></th>
      </tr>
    </tfoot>
  </table>

  <!-- ================= PROFIT ================= -->
  <h2>४. नाफा / घाटा सारांश</h2>
  <table>
    <tr>
      <th>कुल आम्दानी</th>
      <td class="right" id="sumIncome"></td>
    </tr>
    <tr>
      <th>कुल खर्च</th>
      <td class="right" id="sumExpense"></td>
    </tr>
    <tr>
      <th>वार्षिक नाफा / घाटा</th>
      <td class="right" id="profitLoss"></td>
    </tr>
  </table>

  <!-- ================= ROI ================= -->
  <h2>५. लगानी प्रतिफल (५ वर्ष)</h2>
  <table>
    <tr><th>कुल पूँजी</th><td class="right" id="bp_capital"></td></tr>
    <tr><th>५ वर्षको कुल नाफा</th><td class="right" id="fiveYearProfit"></td></tr>
    <tr><th>ROI (%)</th><td class="right" id="roi"></td></tr>
    <tr><th>लगानी फिर्ता अवधि</th><td class="right" id="payback"></td></tr>
  </table>

</div>

<script>
/* ===== LOAD PROJECT ===== */
(function(){
  let key = localStorage.getItem("activeProject");
  if(!key){
    alert("Project Load भएको छैन");
    return;
  }
  let p = JSON.parse(localStorage.getItem(key));
  if(!p) return;

  let s = p.shortInfo||{};
  bp_name.innerText = s.bp_name||"";
  bp_products.innerText = s.bp_products||"";
  bp_org.innerText = s.bp_org||"";
  bp_owner.innerText = s.bp_owner||"";
  bp_contact.innerText = s.bp_contact||"";
  bp_location.innerText = s.bp_location||"";
  bp_market.innerText = s.bp_market||"";
  bp_capital.innerText = s.bp_capital||"";

  /* ===== BUSINESS DETAIL ===== */
  let bd = p.businessDetail||[];
  let bdWrap = document.getElementById("businessDetail");
  bd.forEach((b,i)=>{
    let div = document.createElement("div");
    div.innerHTML = `<h3>${i+1}. ${b.title}</h3><p>${b.content}</p>`;
    bdWrap.appendChild(div);
  });

  /* ===== EXPENSE ===== */
  let exp = p.expenseData||[];
  let expTotal = 0;
  exp.forEach(e=>{
    expTotal += parseFloat(e.amount)||0;
    expenseBody.innerHTML += `
      <tr>
        <td>${e.category}</td>
        <td>${e.title}</td>
        <td class="right">${e.qty}</td>
        <td class="right">${e.rate}</td>
        <td class="right">${e.amount}</td>
      </tr>`;
  });
  totalExpense.innerText = expTotal;
  sumExpense.innerText = expTotal;

  /* ===== INCOME ===== */
  let inc = p.incomeData||[];
  let incTotal = 0;
  inc.forEach(i=>{
    incTotal += parseFloat(i.amount)||0;
    incomeBody.innerHTML += `
      <tr>
        <td>${i.category}</td>
        <td>${i.title}</td>
        <td class="right">${i.qty}</td>
        <td class="right">${i.rate}</td>
        <td class="right">${i.amount}</td>
      </tr>`;
  });
  totalIncome.innerText = incTotal;
  sumIncome.innerText = incTotal;

  let pl = incTotal - expTotal;
  profitLoss.innerText = pl;
  profitLoss.className = pl>=0?"profit":"loss";

  /* ===== ROI ===== */
  fiveYearProfit.innerText = localStorage.fiveYearProfit||"";
  roi.innerText = localStorage.roi||"";
  payback.innerText = localStorage.payback||"";
})();
</script>

</body>
</html>
