<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>farmerbase BPMS тАУ Final Fixed</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
 font-family:"Noto Sans Devanagari","Kalimati","Mangal","Nirmala UI",system-ui,Arial;
 margin:0;background:#f4f7f6;
}
header{
 background:#2e7d32;color:#fff;padding:15px 20px;
}
nav{
 display:flex;gap:8px;flex-wrap:wrap;margin-top:10px
}
nav button{
 background:#ffffff22;color:#fff;border:none;
 padding:8px 14px;border-radius:6px;cursor:pointer
}
nav button.active{background:#1b5e20}

.project-bar{
 margin-top:10px;display:flex;gap:8px;flex-wrap:wrap
}
.project-bar input,.project-bar select{
 padding:6px;font-family:inherit
}

main{
 max-width:1200px;margin:20px auto;background:#fff;
 padding:25px;border-radius:10px
}
.section{display:none}
.section.active{display:block}

h2,h3{color:#2e7d32}
label{font-weight:600;display:block;margin-top:10px}
input,textarea{
 width:100%;padding:8px;margin-top:5px;font-family:inherit
}
textarea{min-height:120px}

table{
 width:100%;border-collapse:collapse;margin-top:10px
}
th,td{
 border:1px solid #ccc;padding:6px;text-align:right
}
th{text-align:center;background:#eef6f0}
td.left{text-align:left}

.box{
 background:#eef6f0;padding:15px;border-left:5px solid #2e7d32
}

button.green{
 background:#2e7d32;color:#fff;border:none;
 padding:8px 14px;border-radius:6px;cursor:pointer
}

footer{
 text-align:center;font-size:13px;color:#555;padding:15px
}

/* тЬЕ PRINT SAFE */
@media print{
 .no-print{display:none}
 body{background:#fff}
 header{background:#fff;color:#000}
}
</style>
</head>

<body>

<header>
<h1>ЁЯМ╛ farmerbase BPMS</h1>
<p>рдХреБрдиреИ рдЭрдиреНрдЭрдЯ рд╡рд┐рдирд╛ рд╡реНрдпрд╡рд╕рд╛рдпрд┐рдХ рдпреЛрдЬрдирд╛/рдкреНрд░рд╕реНрддрд╛рд╡рдирд╛ рдмрдирд╛рдЙрдиреЗ рдпрдиреНрддреНрд░</p>

<!-- GLOBAL PROJECT BAR -->
<div class="project-bar no-print">
 <input id="projectName" placeholder="Project Name">
 <button class="green" onclick="saveProject()">ЁЯТ╛ Save</button>
 <select id="projectList" onchange="loadProject()">
  <option value="">ЁЯУВ Load Project</option>
 </select>
 <button class="green" onclick="window.print()">ЁЯЦия╕П Print / PDF</button>
</div>

<nav class="no-print">
 <button onclick="openTab('home',this)" class="active">ЁЯПа Home</button>
 <button onclick="openTab('short',this)">ЁЯУД Short Info</button>
 <button onclick="openTab('detail',this)">ЁЯУШ рд╡рд┐рд╕реНрддреГрдд рд╡рд┐рд╡рд░рдг</button>
 <button onclick="openTab('expense',this)">ЁЯТ╕ рдЦрд░реНрдЪ</button>
 <button onclick="openTab('income',this)">ЁЯТ░ рдЖрдореНрджрд╛рдиреА</button>
 <button onclick="openTab('pl',this)">ЁЯУК рдирд╛рдлрд╛/рдШрд╛рдЯрд╛</button>
 <button onclick="openTab('roi',this)">ЁЯУИ рел-рд╡рд░реНрд╖реЗ ROI</button>
 <button onclick="openTab('proposal',this)">ЁЯз╛ Full Proposal</button>
</nav>
</header>

<main>

<div id="home" class="section active">
<h2>ЁЯУМ рдкреНрд░рдгрд╛рд▓реА рдкрд░рд┐рдЪрдп</h2>
<p>
рдпреЛ рдкреНрд░рдгрд╛рд▓реА рдХрд┐рд╕рд╛рди/рд╡реНрдпрд╡рд╕рд╛рдпреАрд▓реЗ рдЦрд░реНрдЪ, рдЖрдореНрджрд╛рдиреА, рдирд╛рдлрд╛,
рд▓рдЧрд╛рдиреА рдкреНрд░рддрд┐рдлрд▓ рд░ рдкреВрд░реНрдг рд╡реНрдпрд╡рд╕рд╛рдпрд┐рдХ рдкреНрд░рд╕реНрддрд╛рд╡рдирд╛
рдПрдЙрдЯреИ рдард╛рдЙрдБрдорд╛ рддрдпрд╛рд░ рдЧрд░реНрди рд╕рд╣рдпреЛрдЧ рдЧрд░реНрдЫред
</p>
</div>

<div id="short" class="section">
<h2>ЁЯУД рд╡реНрдпрд╡рд╕рд╛рдпрдХреЛ рд╕рдВрдХреНрд╖рд┐рдкреНрдд рд╡рд┐рд╡рд░рдг</h2>
<label>рд╡реНрдпрд╡рд╕рд╛рдпрдХреЛ рдирд╛рдо</label><input id="bp_name">
<label>рд╕рдЮреНрдЪрд╛рд▓рди рд╕реНрдерд╛рди</label><input id="bp_location">
<label>рд╕рдЮреНрдЪрд╛рд▓рди рдЧрд░реНрдиреЗ рд╕рдВрд╕реНрдерд╛</label><input id="bp_org">
<label>рдкреНрд░реЛрдкреНрд░рд╛рдЗрдЯрд░</label><input id="bp_owner">
<label>рд╕рдореНрдкрд░реНрдХ рд╡реНрдпрдХреНрддрд┐</label><input id="bp_contact">
<label>рдЙрддреНрдкрд╛рджрди</label><textarea id="bp_products"></textarea>
<label>рдореБрдЦреНрдп рдмрдЬрд╛рд░</label><textarea id="bp_market"></textarea>
<button class="green" onclick="buildProposal()">Save</button>
</div>

<div id="detail" class="section">
<h2>ЁЯУШ рд╡реНрдпрд╡рд╕рд╛рдпрдХреЛ рд╡рд┐рд╕реНрддреГрдд рд╡рд┐рд╡рд░рдг</h2>
<div class="box" id="toc"></div>
<div id="topics"></div>
<button class="green" onclick="addTopic()">тЮХ рд╡рд┐рд╖рдп рдердкреНрдиреБрд╣реЛрд╕реН</button>
<button class="green" onclick="buildProposal()">Save</button>
</div>

<div id="expense" class="section">
<h2>ЁЯТ╕ рдЦрд░реНрдЪ</h2>
<div class="box">рдЦрд░реНрдЪ Entry Module рдпрд╣рд╛рдБ Embed рд╣реБрдиреНрдЫ</div>
</div>

<div id="income" class="section">
<h2>ЁЯТ░ рдЖрдореНрджрд╛рдиреА</h2>
<div class="box">рдЖрдореНрджрд╛рдиреА Entry Module рдпрд╣рд╛рдБ Embed рд╣реБрдиреНрдЫ</div>
</div>

<div id="pl" class="section">
<h2>ЁЯУК рдирд╛рдлрд╛ / рдШрд╛рдЯрд╛</h2>
<div class="box">
рдХреБрд▓ рдЦрд░реНрдЪ: <span id="exp">0</span><br>
рдХреБрд▓ рдЖрдореНрджрд╛рдиреА: <span id="inc">0</span><br>
<strong>рдирд╛рдлрд╛: <span id="profit">0</span></strong>
</div>
</div>

<div id="roi" class="section">
<h2>ЁЯУИ рел-рд╡рд░реНрд╖реЗ рдкреНрд░рддрд┐рдлрд▓</h2>
<label>ROI (%)</label><input id="roiVal">
<label>Payback (рд╡рд░реНрд╖)</label><input id="payback">
<button class="green" onclick="buildProposal()">Save</button>
</div>

<div id="proposal" class="section">
<h2>ЁЯз╛ рдкреВрд░реНрдг рд╡реНрдпрд╡рд╕рд╛рдпрд┐рдХ рдкреНрд░рд╕реНрддрд╛рд╡рдирд╛</h2>

<h3 id="p_title"></h3>
<p id="p_location"></p>

<h3>рез. рд╕рдВрдХреНрд╖рд┐рдкреНрдд рд╡рд┐рд╡рд░рдг</h3>
<div id="p_short"></div>

<h3>реи. рд╡рд┐рд╕реНрддреГрдд рд╡рд┐рд╡рд░рдг</h3>
<div id="p_detail"></div>

<h3>рей. рд╡рд┐рддреНрддреАрдп рд╕рд╛рд░рд╛рдВрд╢</h3>
<table>
<tr><th class="left">рд╡рд┐рд╡рд░рдг</th><th>рд░рдХрдо</th></tr>
<tr><td class="left">рдХреБрд▓ рдЦрд░реНрдЪ</td><td id="p_exp"></td></tr>
<tr><td class="left">рдХреБрд▓ рдЖрдореНрджрд╛рдиреА</td><td id="p_inc"></td></tr>
<tr><td class="left">рдирд╛рдлрд╛</td><td id="p_profit"></td></tr>
</table>

<h3>рек. рдкреНрд░рддрд┐рдлрд▓</h3>
<div id="p_roi"></div>
</div>

</main>

<footer>
┬й farmerbase BPMS | Final Fixed Version
</footer>

<script>
/* TAB FIXED */
function openTab(id,btn){
 document.querySelectorAll(".section")
  .forEach(s=>s.classList.remove("active"));
 document.querySelectorAll("nav button")
  .forEach(b=>b.classList.remove("active"));

 document.getElementById(id).classList.add("active");
 if(btn) btn.classList.add("active");
}

/* DETAIL */
let topics=[];
function addTopic(){
 topics.push({title:"",content:""});
 renderTopics();
}
function renderTopics(){
 topicsDiv.innerHTML="";
 topics.forEach((t,i)=>{
  topicsDiv.innerHTML+=`
   <label>${i+1}. рд╡рд┐рд╖рдп</label>
   <input oninput="topics[${i}].title=this.value" value="${t.title}">
   <textarea oninput="topics[${i}].content=this.value">${t.content}</textarea>
  `;
 });
 toc.innerHTML="<strong>рд╡рд┐рд╖рдпрд╕реВрдЪреА</strong><ol>"+
  topics.map(t=>`<li>${t.title}</li>`).join("")+"</ol>";
}

/* PROJECT */
function saveProject(){
 let n=projectName.value;
 if(!n){alert("Project Name рд▓реЗрдЦреНрдиреБрд╣реЛрд╕реН");return;}
 let data={
  short:{
   name:bp_name.value,loc:bp_location.value
  },
  detail:topics,
  roi:roiVal.value,
  payback:payback.value,
  exp:localStorage.totalExpense||0,
  inc:localStorage.totalIncome||0
 };
 localStorage.setItem("project_"+n,JSON.stringify(data));
 refreshList();alert("Project Save рднрдпреЛ");
}
function loadProject(){
 let k=projectList.value;
 if(!k)return;
 let d=JSON.parse(localStorage.getItem(k));
 if(!d)return;
 bp_name.value=d.short.name||"";
 bp_location.value=d.short.loc||"";
 topics=d.detail||[];
 renderTopics();
 roiVal.value=d.roi||"";
 payback.value=d.payback||"";
 localStorage.totalExpense=d.exp||0;
 localStorage.totalIncome=d.inc||0;
 updatePL();buildProposal();
}
function refreshList(){
 projectList.innerHTML='<option value="">ЁЯУВ Load Project</option>';
 for(let k in localStorage)
  if(k.startsWith("project_")){
   let o=document.createElement("option");
   o.value=k;o.text=k.replace("project_","");
   projectList.appendChild(o);
  }
}
window.onload=refreshList;

/* PL */
function updatePL(){
 exp.innerText=localStorage.totalExpense||0;
 inc.innerText=localStorage.totalIncome||0;
 profit.innerText=(localStorage.totalIncome||0)-(localStorage.totalExpense||0);
}

/* PROPOSAL */
function buildProposal(){
 p_title.innerText=bp_name.value;
 p_location.innerText=bp_location.value;
 p_short.innerHTML=`
  <p><strong>рд╕рдВрд╕реНрдерд╛:</strong> ${bp_org.value}</p>
  <p><strong>рдЙрддреНрдкрд╛рджрди:</strong> ${bp_products.value}</p>
 `;
 p_detail.innerHTML=topics.map((t,i)=>
  `<h4>${i+1}. ${t.title}</h4><p>${t.content}</p>`
 ).join("");
 p_exp.innerText=localStorage.totalExpense||0;
 p_inc.innerText=localStorage.totalIncome||0;
 p_profit.innerText=(localStorage.totalIncome||0)-(localStorage.totalExpense||0);
 p_roi.innerText=`ROI: ${roiVal.value}% | Payback: ${payback.value} рд╡рд░реНрд╖`;
}
</script>

</body>
</html>
