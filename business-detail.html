<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Business Detail | BPMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal","Nirmala UI",system-ui,Arial;
  background:#f4f7f6;
  margin:0;
}

/* ===== CONTAINER ===== */
.container{
  max-width:900px;
  margin:30px auto;
  background:#fff;
  padding:30px;
  border-radius:10px;
}

h2{
  margin-top:0;
  color:#2e7d32;
}

/* ===== TOPIC BLOCK ===== */
.topic{
  border:1px solid #ddd;
  border-radius:8px;
  padding:15px;
  margin-top:20px;
}
.topic h3{
  margin:0 0 10px 0;
}

input,textarea{
  width:100%;
  padding:8px;
  margin-top:6px;
  font-family:inherit;
}
textarea{min-height:120px}

button{
  padding:6px 12px;
  background:#1b5e20;
  color:#fff;
  border:none;
  border-radius:5px;
  cursor:pointer;
  margin-top:10px;
}

/* ===== PRINT ===== */
@media print{
  button{display:none}
  body{background:#fff}
  .container{margin:0;padding:0}
}
</style>
</head>

<body>

<div class="container">
  <h2>üìò ‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø / ‡§™‡•ç‡§∞‡§∏‡•ç‡§§‡§æ‡§µ‡§®‡§æ‡§ï‡•ã ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§µ‡§ø‡§µ‡§∞‡§£</h2>

  <div id="topics"></div>

  <button onclick="addTopic()">‚ûï ‡§®‡§Ø‡§æ‡§Å ‡§µ‡§ø‡§∑‡§Ø ‡§•‡§™‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</button>
  <br><br>
  <button onclick="saveDetail()">üíæ Save Business Detail</button>
</div>

<script>
/* ===== RESTORE ACTIVE PROJECT ===== */
(function restoreActiveProject(){
  let key = localStorage.getItem("activeProject");
  if(!key) return;

  let d = JSON.parse(localStorage.getItem(key));
  if(!d) return;

  localStorage.setItem(
    "businessDetail",
    JSON.stringify(d.businessDetail||[])
  );
})();

/* ===== LOAD ===== */
function loadDetail(){
  let list = JSON.parse(localStorage.getItem("businessDetail")||"[]");
  let wrap = document.getElementById("topics");
  wrap.innerHTML = "";

  list.forEach((t,i)=>{
    wrap.appendChild(topicBlock(i,t.title,t.content));
  });
}

/* ===== TOPIC BLOCK ===== */
function topicBlock(index,title="",content=""){
  let div = document.createElement("div");
  div.className = "topic";

  div.innerHTML = `
    <h3>‡§µ‡§ø‡§∑‡§Ø ${index+1}</h3>

    <label>‡§µ‡§ø‡§∑‡§Ø ‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï</label>
    <input value="${title}">

    <label>‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§µ‡§ø‡§µ‡§∞‡§£</label>
    <textarea>${content}</textarea>

    <button onclick="this.parentElement.remove()">‚úñ ‡§π‡§ü‡§æ‡§â‡§®‡•Å‡§π‡•ã‡§∏‡•ç</button>
  `;
  return div;
}

/* ===== ADD TOPIC ===== */
function addTopic(){
  let wrap = document.getElementById("topics");
  wrap.appendChild(topicBlock(wrap.children.length));
}

/* ===== SAVE ===== */
function saveDetail(){
  let result = [];
  document.querySelectorAll(".topic").forEach((t,i)=>{
    let title = t.querySelector("input").value;
    let content = t.querySelector("textarea").value;
    if(title || content){
      result.push({title,content});
    }
  });

  localStorage.setItem("businessDetail", JSON.stringify(result));

  let key = localStorage.getItem("activeProject");
  if(key){
    let p = JSON.parse(localStorage.getItem(key));
    if(p){
      p.businessDetail = result;
      localStorage.setItem(key, JSON.stringify(p));
    }
  }

  alert("Business Detail Save ‡§≠‡§Ø‡•ã");
}

window.onload = loadDetail;
</script>

</body>
</html>
