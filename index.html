<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>BPMS Home | Project Controller</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal","Nirmala UI",system-ui,Arial;
  margin:0;
  background:#f4f7f6;
}

/* ===== HEADER ===== */
header{
  background:#2e7d32;
  color:#fff;
  padding:18px 20px;
}
.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
}
.brand{
  font-size:22px;
  font-weight:700;
}
.status{
  font-size:14px;
  opacity:.9;
}

/* ===== NAV ===== */
nav{
  margin-top:12px;
}
nav a{
  color:#fff;
  text-decoration:none;
  margin-right:14px;
  font-weight:600;
  white-space:nowrap;
}
nav a:hover{ text-decoration:underline; }

/* ===== PROJECT BAR ===== */
.project-bar{
  margin-top:12px;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
.project-bar input,
.project-bar select{
  padding:6px;
  font-family:inherit;
}
.project-bar button{
  padding:6px 12px;
  background:#1b5e20;
  color:#fff;
  border:none;
  border-radius:5px;
  cursor:pointer;
}

/* ===== COVER ===== */
.cover{
  max-width:900px;
  margin:30px auto;
  background:#fff;
  padding:50px 40px;
  border-radius:10px;
  text-align:center;
}
.cover h1{
  font-size:32px;
  margin-bottom:8px;
}
.icon{
  font-size:90px;
  margin:25px 0;
}
.desc{
  font-size:18px;
}
.footer{
  margin-top:35px;
  border-top:1px solid #ddd;
  padding-top:15px;
  font-size:15px;
}
.map{
  margin-top:25px;
}

/* ===== PRINT ===== */
@media print{
  header,nav,.project-bar,.no-print{display:none!important}
  body{background:#fff}
  .cover{
    margin:0;
    padding:0;
    border-radius:0;
    box-shadow:none;
  }
}
</style>
</head>

<body>

<header>
  <div class="topbar">
    <div class="brand">ЁЯМ╛ BPMS тАУ Business Plan Management System</div>
    <div class="status" id="projectStatus">ЁЯФ┤ Project Loaded рдЫреИрди</div>
  </div>

  <nav>
    <a href="index.html">ЁЯПа Home</a>
    <a href="short-info.html">тЬПя╕П Short Info</a>
    <a href="expense-demo.html">ЁЯТ╕ рдЦрд░реНрдЪ</a>
    <a href="income-demo.html">ЁЯТ░ рдЖрдореНрджрд╛рдиреА</a>
    <a href="#" onclick="openProposal()">ЁЯУД Full Proposal</a>
  </nav>

  <div class="project-bar">
    <input id="projectName" placeholder="Project / рдкреНрд░рд╕реНрддрд╛рд╡рдирд╛рдХреЛ рдирд╛рдо">
    <button onclick="saveProject()">ЁЯТ╛ Save</button>

    <select id="projectList">
      <option value="">ЁЯУВ Project рдЫрд╛рдиреНрдиреБрд╣реЛрд╕реН</option>
    </select>
    <button onclick="loadProject()">ЁЯУе Load</button>

    <button onclick="exportProject()">ЁЯУд Export</button>
    <input type="file" id="importFile" accept=".json" style="display:none"
           onchange="importProject(this.files[0])">
    <button onclick="document.getElementById('importFile').click()">ЁЯУе Import</button>

    <button onclick="window.print()">ЁЯЦия╕П Print Cover</button>
  </div>
</header>

<!-- ===== COVER ===== -->
<div class="cover">
  <h1 id="bizName">рд╡реНрдпрд╡рд╕рд╛рдпрдХреЛ рдирд╛рдо</h1>
  <div class="icon" id="bizIcon">ЁЯМ╛</div>
  <div class="desc" id="bizDesc">рд╡реНрдпрд╡рд╕рд╛рдпрд┐рдХ рдкреНрд░рдХреГрддрд┐ / рд╡рд░реНрдгрди</div>

  <div class="map no-print">
    <iframe id="gmap" width="100%" height="250" style="border:0" loading="lazy"></iframe>
  </div>

  <div class="footer">
    <div id="orgName"></div>
    <div id="bizLocation"></div>
  </div>
</div>

<script>
/* ===== UTIL ===== */
function mustHaveProject(){
  if(!localStorage.getItem("activeProject")){
    alert("рдкрд╣рд┐рд▓рд╛ Project Load рд╡рд╛ Save рдЧрд░реНрдиреБрд╣реЛрд╕реН");
    return false;
  }
  return true;
}

/* ===== FULL PROPOSAL (ONLY FROM HOME) ===== */
function openProposal(){
  if(!mustHaveProject()) return;
  window.open("full-proposal.html","_blank");
}

/* ===== ICON ===== */
function getIcon(t){
  t=(t||"").toLowerCase();
  if(t.includes("рдмрдВрдЧреБрд░")||t.includes("pig"))return"ЁЯРЦ";
  if(t.includes("рдмрд╛рдЦреНрд░рд╛")||t.includes("goat"))return"ЁЯРР";
  if(t.includes("рдЧрд╛рдИ"))return"ЁЯРД";
  if(t.includes("рддрд░рдХрд╛рд░реА"))return"ЁЯем";
  return"ЁЯМ╛";
}

/* ===== LOAD COVER ===== */
function loadCover(){
  let s=JSON.parse(localStorage.getItem("shortInfo")||"{}");

  bizName.innerText=s.bp_name||"рд╡реНрдпрд╡рд╕рд╛рдпрдХреЛ рдирд╛рдо";
  bizDesc.innerText=s.bp_products||"рд╡реНрдпрд╡рд╕рд╛рдпрд┐рдХ рдкреНрд░рдХреГрддрд┐ / рд╡рд░реНрдгрди";
  orgName.innerText=s.bp_org||s.bp_owner||"";
  bizLocation.innerText=s.bp_location||"";
  bizIcon.innerText=getIcon(s.bp_products);

  if(s.bp_location){
    gmap.src="https://www.google.com/maps?q="+
      encodeURIComponent(s.bp_location)+"&output=embed";
  }

  projectStatus.innerText =
    localStorage.getItem("activeProject")
    ? "ЁЯЯв Project Loaded: "+localStorage.getItem("activeProject").replace("project_","")
    : "ЁЯФ┤ Project Loaded рдЫреИрди";
}

/* ===== SAVE / LOAD / EXPORT / IMPORT ===== */
function saveProject(){
  let name=projectName.value.trim();
  if(!name){alert("Project рдирд╛рдо рд▓реЗрдЦреНрдиреБрд╣реЛрд╕реН");return;}

  let data={
    shortInfo:JSON.parse(localStorage.shortInfo||"{}"),
    expenseData:JSON.parse(localStorage.expenseData||"[]"),
    incomeData:JSON.parse(localStorage.incomeData||"[]")
  };
  localStorage.setItem("project_"+name,JSON.stringify(data));
  refreshProjects();
  alert("Project Save рднрдпреЛ");
}

function loadProject(){
  let key=projectList.value;
  if(!key){alert("Project рдЫрд╛рдиреНрдиреБрд╣реЛрд╕реН");return;}
  let d=JSON.parse(localStorage.getItem(key));
  if(!d){alert("Project рднреЗрдЯрд┐рдПрди");return;}

  localStorage.setItem("shortInfo",JSON.stringify(d.shortInfo||{}));
  localStorage.setItem("expenseData",JSON.stringify(d.expenseData||[]));
  localStorage.setItem("incomeData",JSON.stringify(d.incomeData||[]));
  localStorage.setItem("activeProject",key);

  loadCover();
}

function exportProject(){
  if(!mustHaveProject())return;
  let key=localStorage.getItem("activeProject");
  let blob=new Blob([localStorage.getItem(key)],{type:"application/json"});
  let a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download=key.replace("project_","")+".json";
  a.click();
}

function importProject(file){
  let r=new FileReader();
  r.onload=function(){
    let data=JSON.parse(r.result);
    let name=prompt("Project рдирд╛рдо рд▓реЗрдЦреНрдиреБрд╣реЛрд╕реН");
    if(!name)return;
    localStorage.setItem("project_"+name,JSON.stringify(data));
    refreshProjects();
    alert("Project Import рднрдпреЛ");
  };
  r.readAsText(file);
}

function refreshProjects(){
  projectList.innerHTML='<option value="">ЁЯУВ Project рдЫрд╛рдиреНрдиреБрд╣реЛрд╕реН</option>';
  for(let k in localStorage){
    if(k.startsWith("project_")){
      let o=document.createElement("option");
      o.value=k;o.text=k.replace("project_","");
      projectList.appendChild(o);
    }
  }
}

window.onload=function(){
  refreshProjects();
  loadCover();
};
</script>

</body>
</html>
