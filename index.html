<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Project Cover | Business Plan</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal","Nirmala UI",system-ui,Arial;
  background:#f4f7f6;
  margin:0;
}

/* ===== HEADER ===== */
header{
  background:#2e7d32;
  color:#fff;
  padding:20px;
}
nav a{
  color:#fff;
  text-decoration:none;
  margin-right:12px;
  font-weight:600;
}
.project-bar{
  margin-top:10px;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
.project-bar input,
.project-bar select{
  padding:6px;
  font-family:inherit;
}
.project-bar button{
  padding:6px 12px;
  background:#1b5e20;
  color:#fff;
  border:none;
  border-radius:5px;
  cursor:pointer;
}

/* ===== COVER ===== */
.cover{
  max-width:900px;
  margin:30px auto;
  background:#fff;
  padding:50px 40px;
  border-radius:10px;
  text-align:center;
}
.cover h1{
  font-size:32px;
  margin-bottom:10px;
}
.icon{
  font-size:90px;
  margin:30px 0;
}
.desc{
  font-size:18px;
  margin-bottom:25px;
}
.map{
  margin-top:25px;
}
.footer{
  margin-top:35px;
  border-top:1px solid #ddd;
  padding-top:15px;
  font-size:15px;
}

/* ===== POPUP ===== */
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  z-index:999;
}
.modal-box{
  background:#fff;
  max-width:800px;
  margin:5% auto;
  padding:25px;
  border-radius:10px;
}
.close{
  float:right;
  cursor:pointer;
  font-weight:700;
}

/* ===== PRINT ===== */
@media print{
  header,.no-print,.modal{display:none!important}
  body{background:#fff}
  .cover{margin:0;padding:0;border-radius:0}
}
</style>
</head>

<body>

<!-- ===== HEADER (SCREEN ONLY) ===== -->
<header class="no-print">
  <h2>üåæ Business Plan Management System</h2>

  <nav>
    <a href="index.html">üè† Home</a>
    <a href="#" onclick="openModal()">‚ÑπÔ∏è ‡§Ö‡§π‡§ø‡§≤‡•á‡§ï‡§æ ‡§∏‡•Ç‡§ö‡§®‡§æ</a>
    <a href="short-info.html">‚úèÔ∏è Edit Info</a>
    <a href="full-proposal.html">üßæ Full Proposal</a>
  </nav>

  <!-- PROJECT MANAGER -->
  <div class="project-bar">
    <input id="projectName" placeholder="Project / ‡§™‡•ç‡§∞‡§∏‡•ç‡§§‡§æ‡§µ‡§®‡§æ‡§ï‡•ã ‡§®‡§æ‡§Æ">
    <button onclick="saveProject()">üíæ Save Project</button>

    <select id="projectList">
      <option value="">üìÇ Project ‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</option>
    </select>

    <button onclick="loadProject()">üì• Load Project</button>
    <button onclick="window.print()">üñ®Ô∏è Print Cover</button>
  </div>
</header>

<!-- ===== COVER ===== -->
<div class="cover">
  <h1 id="bizName">‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø‡§ï‡•ã ‡§®‡§æ‡§Æ</h1>

  <div class="icon" id="bizIcon">üåæ</div>

  <div class="desc" id="bizDesc">
    ‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø‡§ø‡§ï ‡§™‡•ç‡§∞‡§ï‡•É‡§§‡§ø / ‡§µ‡§∞‡•ç‡§£‡§®
  </div>

  <!-- Map (screen only) -->
  <div class="map no-print">
    <iframe id="gmap" width="100%" height="250"
      style="border:0" loading="lazy"></iframe>
  </div>

  <div class="footer">
    <div id="orgName"></div>
    <div id="bizLocation"></div>
  </div>
</div>

<!-- ===== POPUP ===== -->
<div class="modal no-print" id="infoModal">
  <div class="modal-box">
    <span class="close" onclick="closeModal()">‚úñ</span>
    <h3>üìä ‡§Ö‡§π‡§ø‡§≤‡•á‡§ï‡•ã ‡§™‡§∞‡§ø‡§Ø‡•ã‡§ú‡§®‡§æ ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂</h3>
    <div id="popupContent"></div>
  </div>
</div>

<script>
/* ===== ICON SELECTOR ===== */
function getIcon(text){
  text=(text||"").toLowerCase();
  if(text.includes("‡§¨‡§Ç‡§ó‡•Å‡§∞")||text.includes("pig")) return "üêñ";
  if(text.includes("‡§¨‡§æ‡§ñ‡•ç‡§∞‡§æ")||text.includes("goat")) return "üêê";
  if(text.includes("‡§ó‡§æ‡§à")||text.includes("cow")) return "üêÑ";
  if(text.includes("‡§§‡§∞‡§ï‡§æ‡§∞‡•Ä")||text.includes("vegetable")) return "ü•¨";
  if(text.includes("‡§ï‡•É‡§∑‡§ø")) return "üåæ";
  return "üè≠";
}

/* ===== LOAD COVER ===== */
function loadCover(){
  let s = JSON.parse(localStorage.getItem("shortInfo")||"{}");

  bizName.innerText = s.bp_name || "‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø‡§ï‡•ã ‡§®‡§æ‡§Æ";
  bizDesc.innerText = s.bp_products || "‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø‡§ø‡§ï ‡§™‡•ç‡§∞‡§ï‡•É‡§§‡§ø / ‡§µ‡§∞‡•ç‡§£‡§®";
  orgName.innerText = s.bp_org || s.bp_owner || "";
  bizLocation.innerText = s.bp_location || "";
  bizIcon.innerText = getIcon(s.bp_products);

  if(s.bp_location){
    gmap.src =
      "https://www.google.com/maps?q=" +
      encodeURIComponent(s.bp_location) +
      "&output=embed";
  }

  popupContent.innerHTML = `
    <p><strong>‡§ï‡•Å‡§≤ ‡§ñ‡§∞‡•ç‡§ö:</strong> ‡§∞‡•Å. ${localStorage.getItem("totalExpense")||0}</p>
    <p><strong>‡§ï‡•Å‡§≤ ‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä:</strong> ‡§∞‡•Å. ${localStorage.getItem("totalIncome")||0}</p>
    <p><strong>ROI:</strong> ${localStorage.getItem("roi")||""}%</p>
    <p><strong>Payback:</strong> ${localStorage.getItem("payback")||""}</p>
  `;
}

/* ===== POPUP ===== */
function openModal(){ infoModal.style.display="block"; }
function closeModal(){ infoModal.style.display="none"; }

/* ===== PROJECT SAVE ===== */
function saveProject(){
  let name = projectName.value.trim();
  if(!name){
    alert("Project ‡§®‡§æ‡§Æ ‡§≤‡•á‡§ñ‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç");
    return;
  }

  let data = {
    shortInfo: JSON.parse(localStorage.getItem("shortInfo")||"{}"),
    businessDetail: JSON.parse(localStorage.getItem("businessDetail")||"[]"),
    expenseData: JSON.parse(localStorage.getItem("expenseData")||"[]"),
    incomeData: JSON.parse(localStorage.getItem("incomeData")||"[]"),
    totalExpense: localStorage.getItem("totalExpense")||0,
    totalIncome: localStorage.getItem("totalIncome")||0,
    roi: localStorage.getItem("roi")||"",
    payback: localStorage.getItem("payback")||""
  };

  localStorage.setItem("project_"+name, JSON.stringify(data));
  refreshProjects();
  alert("Project Save ‡§≠‡§Ø‡•ã");
}

/* ===== PROJECT LOAD (COMMAND BASED) ===== */
function loadProject(){
  let key = document.getElementById("projectList").value;

  if(!key){
    alert("‡§™‡§π‡§ø‡§≤‡§æ Project ‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç");
    return;
  }

  let d = JSON.parse(localStorage.getItem(key));
  if(!d){
    alert("Project data ‡§≠‡•á‡§ü‡§ø‡§è‡§®");
    return;
  }

  localStorage.setItem("shortInfo", JSON.stringify(d.shortInfo||{}));
  localStorage.setItem("businessDetail", JSON.stringify(d.businessDetail||[]));
  localStorage.setItem("expenseData", JSON.stringify(d.expenseData||[]));
  localStorage.setItem("incomeData", JSON.stringify(d.incomeData||[]));
  localStorage.setItem("totalExpense", d.totalExpense||0);
  localStorage.setItem("totalIncome", d.totalIncome||0);
  localStorage.setItem("roi", d.roi||"");
  localStorage.setItem("payback", d.payback||"");

  // üîë ACTIVE PROJECT
  localStorage.setItem("activeProject", key);

  loadCover();
  alert("Project ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï Load ‡§≠‡§Ø‡•ã");
}

/* ===== PROJECT LIST ===== */
function refreshProjects(){
  let sel = document.getElementById("projectList");
  sel.innerHTML = '<option value="">üìÇ Project ‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</option>';

  for(let k in localStorage){
    if(k.startsWith("project_")){
      let o = document.createElement("option");
      o.value = k;
      o.text = k.replace("project_","");
      sel.appendChild(o);
    }
  }
}

window.onload = function(){
  refreshProjects();
  loadCover();
};
</script>

</body>
</html>
