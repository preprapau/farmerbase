<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Project Cover | BPMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
/* ===== BASE ===== */
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal","Nirmala UI",system-ui,Arial;
  background:#f4f7f6;
  margin:0;
}

/* ===== HEADER (SCREEN ONLY) ===== */
header{
  background:#2e7d32;
  color:#fff;
  padding:20px;
}
nav a{
  color:#fff;
  text-decoration:none;
  margin-right:12px;
  font-weight:600;
}
.project-bar{
  margin-top:10px;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
.project-bar input,
.project-bar select{
  padding:6px;
  font-family:inherit;
}
.project-bar button{
  padding:6px 12px;
  background:#1b5e20;
  color:#fff;
  border:none;
  border-radius:5px;
  cursor:pointer;
}

/* ===== COVER ===== */
.cover{
  max-width:900px;
  margin:30px auto;
  background:#fff;
  padding:50px 40px;
  border-radius:10px;
  text-align:center;
}
.cover h1{
  font-size:32px;
  margin-bottom:10px;
}
.icon{
  font-size:90px;
  margin:30px 0;
}
.desc{
  font-size:18px;
  margin-bottom:25px;
}
.map{
  margin-top:25px;
}
.footer{
  margin-top:35px;
  border-top:1px solid #ddd;
  padding-top:15px;
  font-size:15px;
}

/* ===== POPUP (SCREEN ONLY) ===== */
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  z-index:999;
}
.modal-box{
  background:#fff;
  max-width:800px;
  margin:5% auto;
  padding:25px;
  border-radius:10px;
}
.close{
  float:right;
  cursor:pointer;
  font-weight:700;
}

/* ===== PRINT (FINAL CLEAN) ===== */
@media print{
  /* hide all app UI */
  header,
  nav,
  .project-bar,
  .no-print,
  .modal{
    display:none !important;
  }

  /* page reset */
  body{
    background:#fff;
    margin:0;
  }

  /* cover only */
  .cover{
    margin:0;
    padding:0;
    border-radius:0;
    box-shadow:none;
  }
}
</style>
</head>

<body>

<!-- ===== HEADER ===== -->
<header class="no-print">
  <h2>üåæ Business Plan Management System</h2>

  <nav>
    <a href="index.html">üè† Home</a>
    <a href="#" onclick="openModal()">‚ÑπÔ∏è Project ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂</a>
    <a href="short-info.html">‚úèÔ∏è Edit Short Info</a>
    <a href="full-proposal.html">üßæ Full Proposal</a>
  </nav>

  <!-- PROJECT CONTROLS -->
  <div class="project-bar">
    <input id="projectName" placeholder="Project / ‡§™‡•ç‡§∞‡§∏‡•ç‡§§‡§æ‡§µ‡§®‡§æ‡§ï‡•ã ‡§®‡§æ‡§Æ">
    <button onclick="saveProject()">üíæ Save</button>

    <select id="projectList">
      <option value="">üìÇ Project ‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</option>
    </select>
    <button onclick="loadProject()">üì• Load</button>

    <button onclick="exportProject()">üì§ Export</button>
    <input type="file" id="importFile" accept=".json" style="display:none"
           onchange="importProject(this.files[0])">
    <button onclick="document.getElementById('importFile').click()">üì• Import</button>

    <button onclick="window.print()">üñ®Ô∏è Print Cover</button>
  </div>
</header>

<!-- ===== COVER ===== -->
<div class="cover">
  <h1 id="bizName">‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø‡§ï‡•ã ‡§®‡§æ‡§Æ</h1>

  <div class="icon" id="bizIcon">üåæ</div>

  <div class="desc" id="bizDesc">
    ‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø‡§ø‡§ï ‡§™‡•ç‡§∞‡§ï‡•É‡§§‡§ø / ‡§µ‡§∞‡•ç‡§£‡§®
  </div>

  <!-- Map (screen only, auto hidden in print) -->
  <div class="map no-print">
    <iframe id="gmap" width="100%" height="250"
      style="border:0" loading="lazy"></iframe>
  </div>

  <div class="footer">
    <div id="orgName"></div>
    <div id="bizLocation"></div>
  </div>
</div>

<!-- ===== POPUP ===== -->
<div class="modal no-print" id="infoModal">
  <div class="modal-box">
    <span class="close" onclick="closeModal()">‚úñ</span>
    <h3>üìä Project ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂</h3>
    <div id="popupContent"></div>
  </div>
</div>

<script>
/* ===== ICON BY BUSINESS TYPE ===== */
function getIcon(t){
  t=(t||"").toLowerCase();
  if(t.includes("‡§¨‡§Ç‡§ó‡•Å‡§∞")||t.includes("pig")) return "üêñ";
  if(t.includes("‡§¨‡§æ‡§ñ‡•ç‡§∞‡§æ")||t.includes("goat")) return "üêê";
  if(t.includes("‡§ó‡§æ‡§à")||t.includes("cow")) return "üêÑ";
  if(t.includes("‡§§‡§∞‡§ï‡§æ‡§∞‡•Ä")) return "ü•¨";
  return "üåæ";
}

/* ===== LOAD COVER FROM SHORT INFO ===== */
function loadCover(){
  let s = JSON.parse(localStorage.getItem("shortInfo")||"{}");

  bizName.innerText = s.bp_name || "‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø‡§ï‡•ã ‡§®‡§æ‡§Æ";
  bizDesc.innerText = s.bp_products || "‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø‡§ø‡§ï ‡§™‡•ç‡§∞‡§ï‡•É‡§§‡§ø / ‡§µ‡§∞‡•ç‡§£‡§®";
  orgName.innerText = s.bp_org || s.bp_owner || "";
  bizLocation.innerText = s.bp_location || "";
  bizIcon.innerText = getIcon(s.bp_products);

  if(s.bp_location){
    gmap.src =
      "https://www.google.com/maps?q=" +
      encodeURIComponent(s.bp_location) +
      "&output=embed";
  }

  popupContent.innerHTML = `
    <p>‡§ï‡•Å‡§≤ ‡§ñ‡§∞‡•ç‡§ö: ‡§∞‡•Å. ${localStorage.totalExpense||0}</p>
    <p>‡§ï‡•Å‡§≤ ‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä: ‡§∞‡•Å. ${localStorage.totalIncome||0}</p>
    <p>ROI: ${localStorage.roi||""}%</p>
    <p>Payback: ${localStorage.payback||""}</p>
  `;
}

/* ===== POPUP ===== */
function openModal(){ infoModal.style.display="block"; }
function closeModal(){ infoModal.style.display="none"; }

/* ===== PROJECT SAVE ===== */
function saveProject(){
  let name = projectName.value.trim();
  if(!name){
    alert("Project ‡§®‡§æ‡§Æ ‡§≤‡•á‡§ñ‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç");
    return;
  }

  let data = {
    shortInfo: JSON.parse(localStorage.shortInfo||"{}"),
    businessDetail: JSON.parse(localStorage.businessDetail||"[]"),
    expenseData: JSON.parse(localStorage.expenseData||"[]"),
    incomeData: JSON.parse(localStorage.incomeData||"[]"),
    totalExpense: localStorage.totalExpense||0,
    totalIncome: localStorage.totalIncome||0,
    roi: localStorage.roi||"",
    payback: localStorage.payback||""
  };

  localStorage.setItem("project_"+name, JSON.stringify(data));
  refreshProjects();
  alert("Project Save ‡§≠‡§Ø‡•ã");
}

/* ===== PROJECT LOAD ===== */
function loadProject(){
  let key = projectList.value;
  if(!key){
    alert("Project ‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç");
    return;
  }

  let d = JSON.parse(localStorage.getItem(key));
  if(!d){
    alert("Project ‡§≠‡•á‡§ü‡§ø‡§è‡§®");
    return;
  }

  localStorage.setItem("shortInfo", JSON.stringify(d.shortInfo||{}));
  localStorage.setItem("businessDetail", JSON.stringify(d.businessDetail||[]));
  localStorage.setItem("expenseData", JSON.stringify(d.expenseData||[]));
  localStorage.setItem("incomeData", JSON.stringify(d.incomeData||[]));
  localStorage.setItem("totalExpense", d.totalExpense||0);
  localStorage.setItem("totalIncome", d.totalIncome||0);
  localStorage.setItem("roi", d.roi||"");
  localStorage.setItem("payback", d.payback||"");

  localStorage.setItem("activeProject", key);

  loadCover();
  alert("Project Load ‡§≠‡§Ø‡•ã");
}

/* ===== EXPORT ===== */
function exportProject(){
  let key = localStorage.getItem("activeProject");
  if(!key){
    alert("‡§™‡§π‡§ø‡§≤‡§æ Project Load ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç");
    return;
  }
  let data = localStorage.getItem(key);
  let blob = new Blob([data], {type:"application/json"});
  let a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = key.replace("project_","") + ".json";
  a.click();
}

/* ===== IMPORT ===== */
function importProject(file){
  let r = new FileReader();
  r.onload = function(){
    let data = JSON.parse(r.result);
    let name = prompt("Project ‡§®‡§æ‡§Æ ‡§≤‡•á‡§ñ‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç");
    if(!name) return;
    localStorage.setItem("project_"+name, JSON.stringify(data));
    refreshProjects();
    alert("Project Import ‡§≠‡§Ø‡•ã");
  };
  r.readAsText(file);
}

/* ===== PROJECT LIST ===== */
function refreshProjects(){
  projectList.innerHTML = '<option value="">üìÇ Project ‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</option>';
  for(let k in localStorage){
    if(k.startsWith("project_")){
      let o = document.createElement("option");
      o.value = k;
      o.text = k.replace("project_","");
      projectList.appendChild(o);
    }
  }
}

window.onload = function(){
  refreshProjects();
  loadCover();
};
</script>

</body>
</html>
