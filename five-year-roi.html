<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Five Year ROI | BPMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal","Nirmala UI",system-ui,Arial;
  background:#f4f7f6;
  margin:0;
}
.container{
  max-width:1000px;
  margin:35px auto;
  background:#fff;
  padding:30px;
  border-radius:10px;
}
h2{
  margin-top:0;
  color:#2e7d32;
  text-align:center;
}

/* ===== ASSUMPTIONS ===== */
.assumptions{
  border:1px solid #ddd;
  border-radius:8px;
  padding:15px;
  margin-bottom:25px;
}
.assumptions label{
  display:inline-block;
  margin-right:20px;
  font-weight:600;
}
.assumptions input{
  width:80px;
  padding:5px;
  margin-left:6px;
  font-family:inherit;
}

/* ===== TABLE ===== */
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  border:1px solid #ddd;
  padding:8px;
  text-align:center;
}
th{
  background:#f0f0f0;
}

/* ===== SUMMARY ===== */
.summary{
  margin-top:25px;
  border:1px solid #ddd;
  border-radius:8px;
  padding:15px;
}
.row{
  display:flex;
  justify-content:space-between;
  padding:6px 0;
  border-bottom:1px dashed #ddd;
}
.row:last-child{border-bottom:none}
.label{font-weight:600}
.value{font-weight:700}
.profit{color:green}
.loss{color:red}

/* ===== PRINT ===== */
@media print{
  body{background:#fff}
  .container{margin:0;padding:0}
}
</style>
</head>

<body>

<div class="container">
  <h2>üìà ‡§™‡§æ‡§Å‡§ö ‡§µ‡§∞‡•ç‡§∑‡•á ‡§®‡§æ‡§´‡§æ, ROI ‡§§‡§•‡§æ ‡§≤‡§ó‡§æ‡§®‡•Ä ‡§´‡§ø‡§∞‡•ç‡§§‡§æ ‡§Ö‡§µ‡§ß‡§ø</h2>

  <!-- ===== ASSUMPTIONS ===== -->
  <div class="assumptions">
    <label>‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä ‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï ‡§µ‡•É‡§¶‡•ç‡§ß‡§ø (%)
      <input id="incGrowth" type="number" value="5">
    </label>
    <label>‡§ñ‡§∞‡•ç‡§ö ‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï ‡§µ‡•É‡§¶‡•ç‡§ß‡§ø (%)
      <input id="expGrowth" type="number" value="3">
    </label>
    <button onclick="recalculate()">üîÑ Recalculate</button>
  </div>

  <!-- ===== TABLE ===== -->
  <table>
    <thead>
      <tr>
        <th>‡§µ‡§∞‡•ç‡§∑</th>
        <th>‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä (‡§∞‡•Å.)</th>
        <th>‡§ñ‡§∞‡•ç‡§ö (‡§∞‡•Å.)</th>
        <th>‡§®‡§æ‡§´‡§æ / ‡§ò‡§æ‡§ü‡§æ (‡§∞‡•Å.)</th>
      </tr>
    </thead>
    <tbody id="roiBody"></tbody>
  </table>

  <!-- ===== SUMMARY ===== -->
  <div class="summary">
    <div class="row">
      <div class="label">‡•´ ‡§µ‡§∞‡•ç‡§∑‡§ï‡•ã ‡§ï‡•Å‡§≤ ‡§®‡§æ‡§´‡§æ</div>
      <div class="value" id="totalProfit">0</div>
    </div>
    <div class="row">
      <div class="label">‡§≤‡§ó‡§æ‡§®‡•Ä‡§ï‡•ã ‡§™‡•ç‡§∞‡§§‡§ø‡§´‡§≤ (ROI)</div>
      <div class="value"><span id="roi">‚Äì</span> %</div>
    </div>
    <div class="row">
      <div class="label">‡§≤‡§ó‡§æ‡§®‡•Ä ‡§´‡§ø‡§∞‡•ç‡§§‡§æ ‡§Ö‡§µ‡§ß‡§ø</div>
      <div class="value"><span id="payback">‚Äì</span> ‡§µ‡§∞‡•ç‡§∑</div>
    </div>
  </div>
</div>

<script>
/* ===== RESTORE ACTIVE PROJECT ===== */
(function restoreActiveProject(){
  let key = localStorage.getItem("activeProject");
  if(!key) return;
  let d = JSON.parse(localStorage.getItem(key));
  if(!d) return;

  if(d.totalIncome)  localStorage.setItem("totalIncome", d.totalIncome);
  if(d.totalExpense) localStorage.setItem("totalExpense", d.totalExpense);
  if(d.shortInfo){
    localStorage.setItem("shortInfo", JSON.stringify(d.shortInfo));
  }
})();

/* ===== CORE CALC ===== */
function recalculate(){
  let baseIncome  = parseFloat(localStorage.getItem("totalIncome")) || 0;
  let baseExpense = parseFloat(localStorage.getItem("totalExpense")) || 0;

  let incG = parseFloat(document.getElementById("incGrowth").value) || 0;
  let expG = parseFloat(document.getElementById("expGrowth").value) || 0;

  let tbody = document.getElementById("roiBody");
  tbody.innerHTML = "";

  let income = baseIncome;
  let expense = baseExpense;
  let totalProfit = 0;
  let cumulativeProfit = 0;
  let paybackYear = "‚Äì";

  for(let y=1; y<=5; y++){
    if(y>1){
      income  = income  * (1 + incG/100);
      expense = expense * (1 + expG/100);
    }
    let profit = income - expense;
    totalProfit += profit;
    cumulativeProfit += profit;

    let tr = document.createElement("tr");
    tr.innerHTML = `
      <td>‡§µ‡§∞‡•ç‡§∑ ${y}</td>
      <td>${income.toFixed(2)}</td>
      <td>${expense.toFixed(2)}</td>
      <td class="${profit>=0?'profit':'loss'}">${profit.toFixed(2)}</td>
    `;
    tbody.appendChild(tr);

    // simple payback: first year cumulative >= initial investment
    let s = JSON.parse(localStorage.getItem("shortInfo")||"{}");
    let investment = parseFloat(s.bp_capital)||0;
    if(investment>0 && cumulativeProfit>=investment && paybackYear==="‚Äì"){
      paybackYear = y;
    }
  }

  document.getElementById("totalProfit").innerText =
    (totalProfit>=0?"‡§∞‡•Å. ":"‡§∞‡•Å. ") + totalProfit.toFixed(2);

  // ROI = (Total Profit / Initial Capital) * 100
  let s = JSON.parse(localStorage.getItem("shortInfo")||"{}");
  let capital = parseFloat(s.bp_capital)||0;
  let roi = capital>0 ? (totalProfit/capital)*100 : 0;

  document.getElementById("roi").innerText = roi.toFixed(2);
  document.getElementById("payback").innerText = paybackYear;

  // store for proposal
  localStorage.setItem("fiveYearProfit", totalProfit.toFixed(2));
  localStorage.setItem("roi", roi.toFixed(2));
  localStorage.setItem("payback", paybackYear);
}

window.onload = recalculate;
</script>

</body>
</html>
