<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Expense Entry | BPMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans Devanagari","Kalimati","Mangal","Nirmala UI",system-ui,Arial;
  background:#f4f7f6;
  margin:0;
}
.container{
  max-width:1000px;
  margin:25px auto;
  background:#fff;
  padding:25px;
  border-radius:10px;
}
h2{margin-top:0;color:#2e7d32}

/* ===== PROGRESS ===== */
.progress-wrap{
  background:#e8f5e9;
  border:1px solid #c8e6c9;
  padding:12px;
  border-radius:8px;
  margin-bottom:15px;
}
.progress-title{font-weight:700;margin-bottom:6px}
.steps{font-size:13px}
.steps span{padding:3px 6px;border-radius:10px;background:#eee}
.steps .active{background:#2e7d32;color:#fff}
.steps .done{background:#a5d6a7}
.bar-wrap{height:8px;background:#ddd;border-radius:6px;overflow:hidden;margin-top:8px}
.bar{height:100%;background:#2e7d32;width:43%}

/* ===== AUTOSAVE ===== */
#autosaveStatus{
  font-size:13px;
  color:#2e7d32;
  margin-bottom:10px;
}

/* ===== NOTICE ===== */
#noticeBox{
  display:none;
  background:#fff8e1;
  border:1px solid #ffe082;
  padding:10px;
  border-radius:6px;
  margin-bottom:15px;
  font-size:14px;
}

/* ===== FORM ===== */
label{font-weight:600}
select,input{
  padding:6px;
  margin-right:6px;
  font-family:inherit;
}
input[type=number]{width:90px}
input[type=text]{width:180px}

/* ===== TABLE ===== */
table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}
th,td{
  border:1px solid #ccc;
  padding:6px;
  text-align:left;
}
th{background:#f0f0f0}
.right{text-align:right}

/* ===== NAV ===== */
.nav{
  display:flex;
  justify-content:space-between;
  margin-top:30px;
}
button{
  padding:8px 16px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  background:#2e7d32;
  color:#fff;
}
.del{
  background:#c62828;
}

/* highlight */
.highlight{
  border:2px solid #ff9800 !important;
  background:#fff3e0;
}

@media print{
  button,.progress-wrap,#autosaveStatus,#noticeBox{display:none}
}
</style>
</head>

<body>

<div class="container">

<!-- ===== PROGRESS ===== -->
<div class="progress-wrap">
  <div class="progress-title">‡§ö‡§∞‡§£ 3 / 7 (43%)</div>
  <div class="steps">
    <span class="done">Short Info</span> ‚Üí
    <span class="done">Detail</span> ‚Üí
    <span class="active">Expense</span> ‚Üí
    <span>Income</span> ‚Üí
    <span>Profit</span> ‚Üí
    <span>ROI</span> ‚Üí
    <span>Proposal</span>
  </div>
  <div class="bar-wrap"><div class="bar"></div></div>
</div>

<div id="autosaveStatus">üíæ Saved</div>
<div id="noticeBox"></div>

<h2>üí∏ ‡§ñ‡§∞‡•ç‡§ö ‡§µ‡§ø‡§µ‡§∞‡§£ (‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï)</h2>

<!-- ===== ENTRY ===== -->
<label>‡§ï‡•ç‡§Ø‡§æ‡§ü‡•á‡§ó‡•ã‡§∞‡•Ä</label>
<select id="category">
  <option value="‡§Æ‡•á‡§∂‡•Ä‡§® ‡§î‡§ú‡§æ‡§∞ / ‡§™‡•ç‡§∞‡§µ‡§ø‡§ß‡§ø">‡§Æ‡•á‡§∂‡•Ä‡§® ‡§î‡§ú‡§æ‡§∞ / ‡§™‡•ç‡§∞‡§µ‡§ø‡§ß‡§ø</option>
  <option value="‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§ß‡§æ‡§∞ ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£">‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§ß‡§æ‡§∞ ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£</option>
  <option value="‡§ï‡§ö‡•ç‡§ö‡§æ ‡§™‡§¶‡§æ‡§∞‡•ç‡§• / ‡§™‡§∂‡•Å / ‡§¨‡§ø‡§â">‡§ï‡§ö‡•ç‡§ö‡§æ ‡§™‡§¶‡§æ‡§∞‡•ç‡§• / ‡§™‡§∂‡•Å / ‡§¨‡§ø‡§â</option>
  <option value="‡§ï‡§æ‡§Æ‡§¶‡§æ‡§∞ ‡§ñ‡§∞‡•ç‡§ö">‡§ï‡§æ‡§Æ‡§¶‡§æ‡§∞ ‡§ñ‡§∞‡•ç‡§ö</option>
  <option value="‡§≠‡•á‡§ü‡•á‡§∞‡•Ä‡§®‡§∞‡•Ä / ‡§î‡§∑‡§ß‡§ø / ‡§µ‡§ø‡§∑‡§æ‡§¶‡•Ä">‡§≠‡•á‡§ü‡•á‡§∞‡•Ä‡§®‡§∞‡•Ä / ‡§î‡§∑‡§ß‡§ø / ‡§µ‡§ø‡§∑‡§æ‡§¶‡•Ä</option>
  <option value="‡§µ‡§ø‡§µ‡§ø‡§ß ‡§ñ‡§∞‡•ç‡§ö">‡§µ‡§ø‡§µ‡§ø‡§ß ‡§ñ‡§∞‡•ç‡§ö</option>
</select>

<input id="title" type="text" placeholder="‡§ñ‡§∞‡•ç‡§ö ‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï">
<input id="qty" type="number" placeholder="‡§™‡§∞‡§ø‡§Æ‡§æ‡§£">
<input id="rate" type="number" placeholder="‡§¶‡§∞">
<button onclick="addExpense()">‚ûï Add</button>

<!-- ===== TABLE ===== -->
<table>
<thead>
<tr>
  <th>‡§ï‡•ç‡§Ø‡§æ‡§ü‡•á‡§ó‡•ã‡§∞‡•Ä</th>
  <th>‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï</th>
  <th class="right">‡§™‡§∞‡§ø‡§Æ‡§æ‡§£</th>
  <th class="right">‡§¶‡§∞</th>
  <th class="right">‡§∞‡§ï‡§Æ</th>
  <th></th>
</tr>
</thead>
<tbody id="tbody"></tbody>
<tfoot>
<tr>
  <th colspan="4" class="right">‡§ï‡•Å‡§≤ ‡§ñ‡§∞‡•ç‡§ö</th>
  <th class="right" id="totalExpense">0</th>
  <th></th>
</tr>
</tfoot>
</table>

<div class="nav">
  <button onclick="goPrev()">‚¨Ö Previous</button>
  <button onclick="goNext()">Next ‚û°</button>
</div>

</div>

<script>
/* ===== SAFETY ===== */
let activeKey = localStorage.getItem("activeProject");
if(!activeKey){
  alert("‡§™‡§π‡§ø‡§≤‡•á Home ‡§¨‡§æ‡§ü Project ‡§ñ‡•ã‡§≤‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç");
  location.href="index.html";
}
let project = JSON.parse(localStorage.getItem(activeKey));

/* ===== DATA ===== */
let expenseData = project.expenseData || [];

/* ===== RENDER ===== */
function render(){
  tbody.innerHTML="";
  let total=0;

  expenseData.forEach((e,i)=>{
    total += e.amount;
    tbody.innerHTML += `
      <tr>
        <td>${e.category}</td>
        <td>${e.title}</td>
        <td class="right">${e.qty}</td>
        <td class="right">${e.rate}</td>
        <td class="right">${e.amount}</td>
        <td><button class="del" onclick="removeExpense(${i})">‚úñ</button></td>
      </tr>`;
  });

  totalExpense.innerText = total;
  checkNotices();
}
render();

/* ===== ADD ===== */
function addExpense(){
  let q = Number(qty.value||0);
  let r = Number(rate.value||0);
  let amt = q*r;

  expenseData.push({
    category:category.value,
    title:title.value,
    qty:q,
    rate:r,
    amount:amt
  });

  title.value="";qty.value="";rate.value="";
  saveExpense();
}

/* ===== REMOVE ===== */
function removeExpense(i){
  expenseData.splice(i,1);
  saveExpense();
}

/* ===== SAVE ===== */
function saveExpense(){
  project.expenseData = expenseData;
  project.lastEdited = new Date().toLocaleString("ne-NP");
  localStorage.setItem(activeKey, JSON.stringify(project));
  autosaveStatus.innerText="‚úî Saved";
  render();
}

/* ===== AUTOSAVE ===== */
let t;
document.querySelectorAll("input,select").forEach(el=>{
  el.addEventListener("input",()=>{
    autosaveStatus.innerText="‚è≥ Saving...";
    clearTimeout(t);
    t=setTimeout(saveExpense,700);
  });
});

/* ===== NOTICE ===== */
function checkNotices(){
  if(expenseData.length===0){
    noticeBox.style.display="block";
    noticeBox.innerHTML="‚ÑπÔ∏è <b>‡§∏‡•Ç‡§ö‡§®‡§æ:</b> ‡§π‡§æ‡§≤‡§∏‡§Æ‡•ç‡§Æ ‡§ï‡•Å‡§®‡•à ‡§ñ‡§∞‡•ç‡§ö ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§•‡§™‡§ø‡§è‡§ï‡•ã ‡§õ‡•à‡§®‡•§";
  }else{
    noticeBox.style.display="none";
  }
}

/* ===== FINAL LOCK ===== */
if(project.status==="final"){
  document.querySelectorAll("input,select,button").forEach(b=>{
    if(b.innerText.includes("Previous")||b.innerText.includes("Next")) return;
    b.disabled=true;b.style.opacity=.7;
  });
}

/* ===== NAV ===== */
function goPrev(){location.href="business-detail.html";}
function goNext(){saveExpense();location.href="income-demo.html";}
</script>

</body>
</html>
